---
title: "HW4"
author: "KurochkinaDN"
date: "2024-03-30"
output: html_document
---

### Задание 1 (2 балла)
Рассмотрите следующую статистическую гипотезу.

Проводят некоторое исследование пациентов с артериальной гипертензией. Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

Задайте seed для воспроизводимости результатов (функция set.seed()). Задайте размер выборки sample_size <- 30. Задайте значение среднего артериального давления до приема нового препарата и после.

Затем:

Сформулируйте нулевую и альтернативную гипотезы.
Определите уровень значимости.
Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
Определите наблюдаемое значение статистики, а также критическое значение статистики.
Оцените и прокомментируйте статистическую значимость.


```{r}
set.seed(300)
# т.к. не оговорено иного - средним значением АД ДО приема и ПОСЛЕ приема буду считать систолическое АД. Так же, я считаю, что все пациенты УЖЕ принимают базисную терапию, и одна из групп ДОПОЛНИТЕЛЬНО к базисной терапии получает исследуемый препарат. таким образом, пациенты до приема исслед.преарата - это пациенты получающие базисную терапию, а после приема исслед.препарата - получающие базисную терапию + исследуемый препарат.

# генерация выборки

# Установка размера выборки
sample_size <- 30

# Задание среднего АД до приема препарата
arterial_pressure_before <- 180

# Задание среднего АД после приема препарата
arterial_pressure_after <- 120

# Генерация выборки до приема препарата
ad_before <- rnorm(sample_size, arterial_pressure_before, 10)

# Генерация выборки после приема препарата
ad_after <- rnorm(sample_size, arterial_pressure_after, 10)

data <- data.frame(before = ad_before, after = ad_after) # оформление датасета в таблицу

print(data)
```
```{r}
#Для выбора стат.теста необходимо проверить распределение на нормальность.
shapiro.test(data$before)

shapiro.test(data$after)

```
для столбца before p-value = 0.7312 => данные распределены нормально (принимаем нулевую гипотезу)
для столбца after p-value = 0.9388 => данные распределены нормально (принимаем нулевую гипотезу)


*Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор* 

тк данные распределены нормально, для сравнения средних выборки ДО и ПОСЛЕ применения препарата, при условии нормального распределения данных, подойдет парный t-тест.

*сформулируем нулевую и альтернативную гипотезы*

Н0 - внедрение нового препарата не улучшает результатов лечения (АД не снижается)
H1 - внедрение нового препарата улучшает результаты лечения (АД снижается)

*определите уровень значимости*
 
уровень значимости альфа = 0,05 (5%)

```{r}
t.test(data$before, data$after, paired = TRUE)

```

 *Определите наблюдаемое значение статистики, а также критическое значение статистики*
 
 t = 30.951 - наблюдаемое значение статистики.
```{r}
# критическое значение статистики для df=29 (кол-во степеней свободы, рассчитано в результате т-теста)

alpha = 0.05
qt(1 - alpha/2, df = 29)

print(qt)

```

Вывод: критическое значение статистики = 2.04523

наблюдаемое значение статистики (30.951) значительно выше критического значения статистики (2.04), значит мы так же можем отвергнуть нулевую гипотезу, и значит,  существует статистически значимая разница между двумя выборками.

*Оцените и прокомментируйте статистическую значимость*

Доверительный интервал (58.50749, 66.78686) - не включает ноль, значит, разница средних является статистически значимой.

p-value < 2.2e-16, значит, отвергаем нулевую гипотезу, и принимаем альтернативную гипотезу - true mean difference is not equal to 0 = >  внедрение нового препарата улучшает результаты лечения.




### Задание 2 (2 балла)
Рассмотрите следующую статистическую гипотезу.

Существует некоторая связь между курением и развитием рака легких. Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2

Рассмотрите два случая: для выборки sample_size1 <- 100 и выборки sample_size2 <- 30. Сгенерируйте данные по курению с помощью функции rep(), пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.

Затем:

Сформулируйте нулевую и альтернативную гипотезы.
Определите уровень значимости.
Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
Определите наблюдаемое значение статистики, а также критическое значение статистики.
Оцените и прокомментируйте статистическую значимость.

```{r}
# генерация выборки
set.seed(10) 
# Генерируем данные о курении для выборки размером 100 с отношением курящих к некурящим 1:1
smoking_status <- c(rep("Курящий", 50), rep("Некурящий", 50))

# Вероятность заболевания раком легких для курящих
prob_cancer_smoker <- 0.8

# Вероятность заболевания раком легких для некурящих
prob_cancer_nonsmoker <- 0.2

# Генерируем данные о заболевании раком легких с учетом вероятностей для курящих и некурящих

cancer_smoker <- rbinom(50, 1, prob_cancer_smoker)
cancer_nonsmoker <- rbinom(50, 1, prob_cancer_nonsmoker)

# делаем из этого датафрейм
lc <- c(cancer_smoker, cancer_nonsmoker)
df_100 <- data.frame(smoking = smoking_status,
                        cancer = lc)

```

```{r}
# Генерируем данные о курении для выборки размером 30 с отношением курящих к некурящим 1:1
smoking_status <- c(rep("Курящий", 15), rep("Некурящий", 15))

# Вероятность заболевания раком легких для курящих
prob_cancer_smoker <- 0.8

# Вероятность заболевания раком легких для некурящих
prob_cancer_nonsmoker <- 0.2

# Генерируем данные о заболевании раком легких с учетом вероятностей для курящих и некурящих
set.seed(10) 
cancer_smoker30 <- rbinom(15, 1, prob_cancer_smoker)
cancer_nonsmoker30 <- rbinom(15, 1, prob_cancer_nonsmoker)

# делаем из этого датафрейм
lc30 <- c(cancer_smoker30, cancer_nonsmoker30)
df_30 <- data.frame(smoking = smoking_status, cancer = lc30)

```
*Сформулируйте нулевую и альтернативную гипотезы*

H0 = вероятность заболевания раком легких для курящих и некурящих одинакова
Н1 = вероятность заболевания раком легких у курящих и некурящих различается


*Определите уровень значимости*
уровень значимости альфа = 0,05 (5%)


*Выберите статистический тест для проверки гипотезы и аргументируйте свой выбо.*

в данной ситуации, тк нам необходимо выявить взаимосвязь между двумя категориальными переменными, подойдет либо тест Фишера, либо критерий хи-квадрат.

```{r}
# Таблица сопряженности для курящих и некурящих для выборок в 30 и в 100 чел
contingency_table100 <- table(df_100$smoking, df_100$cancer)
contingency_table30 <- table(df_30$smoking, df_30$cancer)

print(contingency_table100)
print(contingency_table30)
```
как видно из таблицы сопряженности, количество наблюдений (частота встречаемости) в таблицах есть менее 5 (в таблице для 30 наблюдений), а значит в данной ситуации лучше выбрать тест Фишера, он подойдет для обеих выборок еще и потому, что тест Фишера может использоваться независимо от особенностей выборки.
Однако, для выборки в 100 наблюдений можно применить и тест Фишера, и критерий хи-квадрат (с поправкой Йетса, т.к.в ячейке меньше 10 наблюдений).



```{r}
#тест Фишера для выборки в 100 наблюдений
fisher_result <- fisher.test(contingency_table100)
print(fisher_result)
```
Вывод: p-value = 4.621e-15, значит принимается альтернативная гипотеза - вероятность заболевания раком легких у курящих и некурящих различается.
а, учитывая исходные данные о том, что  у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2, можно сказать, что курящие заболевают раком легких чаще, чем некурящие.
95% доверительный интервал не пересекает 0, значит разница средних является статистически значимой.

```{r}
#критерий хи-квадрат для выборки в 100 человек

# Проведение критерия хи-квадрат
chi_square_result <- chisq.test(contingency_table100)

# Вывод результатов теста
print(chi_square_result)

```
Вывод: p-value = 1.302e-13 значит принимается альтернативная гипотеза - вероятность заболевания раком легких у курящих и некурящих различается.
а, учитывая исходные данные о том, что  у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2, можно сказать, что курящие заболевают раком легких чаще, чем некурящие.

Результаты критерий хи-квадрат и теста Фишера совпадают.


Для критерия хи-квадрат возможно рассчитать критическое значение статистики

```{r}
# критическое значение статистики для df=1 (кол-во степеней свободы, рассчитано в результате хи-квадрат критерия)

alpha = 0.05
q_X_squared <- qt(1 - alpha/2, df = 1)

print(q_X_squared)

```
Вывод: Для критерия хи-квадрат критическое значение статистики = 12.7062
Для критерия хи-квадрат наблюдаемое значение статистики = 54.848

наблюдаемое значение статистики выше критического значения статистики, значит мы так же можем отвергнуть нулевую гипотезу, и значит,  существует статистически значимая разница между двумя выборками.

Что, опять же, подтверждает вышесказанное - курильщики чаще чем некурильщики заболевают раком легкого.


Проведем тест Фишера для выборки в 30 человек:

```{r}
#тест Фишера для выборки в 30 наблюдений
fisher.test(contingency_table30)

```
Вывод: p-value = 1.052e-05, значит как и в предыдущих случаях принимается альтернативная гипотеза -  вероятность заболевания раком легких у курящих и некурящих различается. А, учитывая исходные данные о том, что  у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2, можно сказать, что курящие заболевают раком легких чаще, чем некурящие.
Доверительный интервал одной из границ касается 0, что может быть объяснено малым размером выборки.



*Определите наблюдаемое значение статистики, а также критическое значение статистики*
Для теста Фишера неовзможно рассчитать значение статистики из-за математики самого теста - он рассчитывает "в лоб" значение р-value, и доверительный интервал, но не рассчитывает значение статистики.

*Оцените и прокомментируйте статистическую значимость*
оценка p-value была представлена выше.



### Задание 3 (3 балла)
Рассмотрите следующую статистическую гипотезу.

Применение нового метода лечения синдрома раздраженного кишечника (СРК) значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

Исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение.

Что нужно сделать:

Сформулируйте нулевую и альтернативную гипотезы.
Определите уровень значимости.
Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
Определите наблюдаемое значение статистики, а также критическое значение статистики.
Оцените и прокомментируйте статистическую значимость.

*Предположим, есть выборка в 100 человек, 50 человек прошли лечение новым методом (группа 1), 50 - диетой (группа 2). Эти выборки независимы, распределены одинаково*

```{r}
set.seed(50)

# Среднее значение интенсивности боли для группы 1 (новое лечение)
mean_pain_group1 <- 4.5

# Стандартное отклонение интенсивности боли для группы 1
sd_pain_group1 <- 2

# Среднее значение интенсивности боли для группы 2 (диета)
mean_pain_group2 <- 6

# Стандартное отклонение интенсивности боли для группы 2
sd_pain_group2 <- 2

# Генерируем данные о боли для группы 1
pain_group1 <- rnorm(50, mean = mean_pain_group1, sd = sd_pain_group1)

# Генерируем данные о боли для группы 2
pain_group2 <- rnorm(50, mean = mean_pain_group2, sd = sd_pain_group2)

# Создаем датафрейм с данными о боли
pain_data <- data.frame(
  group = c(rep("Новое лечение", 50), rep("Диета", 50)),
  pain = c(pain_group1, pain_group2)
)

# Проверяем результат
head(pain_data)
```
*Сформулируйте нулевую и альтернативную гипотезы.*
H0 = новый метод НЕ ВЛИЯЕТ на уровень болевых симптомов по сравнению с диетой для СРК
Н1 = новый метод ЗНАЧИМО МЕНЯЕТ уровень болевых симптомов по сравнению с диетой для СРК


*Определите уровень значимости*
уровень значимости alpha = 0.05 (5%)


*Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.*

Перед выбором статтеста нужно проверить распределение на нормальность.
Например, тестом Шапиро-Уилка.


```{r}
shapiro.test(pain_group1)

shapiro.test(pain_group2)

```
Мы видим, что для группы 1  p-value = 0.233, а для группы 2 p-value = 0.7752, значит в обоих случаях мы принимаем нулевую гипотезу - данные распределены нормально.

Итого, мы имеем 2 независимые выборки, где данные распределены нормально, а группы независимы. Переменные pain - непрерывные, а group - категориальные. Надо проверить влияние переменной group на pain. В данном случае подойдет t-тест для независимых выборок.
T-тест для независимых выборок проверяет, существует ли статистически значимая разница в средних значениях двух независимых выборок. В данном случае мы будем сравнивать среднее значение pain в группе нового лечения со средним значением pain в группе диетотерапии.


```{r}
t_result <- t.test(data = pain_data, pain ~ group)
print(t_result)
```
*Определите наблюдаемое значение статистики, а также критическое значение статистики*

наблюдаемое значение статистики для т-теста = t = 3.9275

```{r}
# критическое значение статистики для т-теста при df = 97.765 и alpha = 0.05

q_tt <- qt(1 - 0.05/2, df = 97.765)

print(q_tt)
```
критическое значение статистики для т-теста = t = 1.984527

*Оцените и прокомментируйте статистическую значимость*
1) `p-value = 0.00016`, что меньше чем `alpha = 0.05`? а значит принимаем альтернативную гипотезу - новый метод ЗНАЧИМО МЕНЯЕТ уровень болевых симптомов по сравнению с диетой для СРК.
2) критическое значение статистики для т-теста `q_tt = 1.984527` ниже, чем наблюдаемое значение статистики для т-теста `t = 3.9275`, значит мы так же можем отвергнуть нулевую гипотезу, и значит, существует статистически значимая разница между двумя выборками.
3) 95% ДИ = (0.7752677, 2.3589449) - не пересекает ноль что подтверждает стат.значимую разницу между средними 2х выборок.
4) и, наконец, среднее значение боли для диеты = 5.806499,, что выше, чем для группы новое лечение (=  4.239393), значит на основании вышенаписанного можно сделать вывод, что новое лечение статистически значимо СНИЖАЕТ уровень боли, чем диетотерапия.


### Задание 4 (4 балла)
Рассмотрите следующую гипотезу.
Проводится исследование, в котором исследуются три противоопухолевые препарата A, B плацебо (0) на трех группах мышей. В каждой из трех групп по 10 мышей.  Оценивается размер опухоли у мыши.
Сгенерируйте датасет следующим образом:

tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)

Постройте на одном графике три “ящика с усами” для наглядности.
проведите дисперсионный анализ, чтобы выяснить, есть ли разница между размером опухоли во всех группах. 

Прокомментируйте получившийся результат.

с помощью функции TukeyHSD() проведите попарные сравнения, используя критерий Тьюки. Прокомментируйте полученные результаты.


```{r}
# генерим рандомный датасет.
library(tibble)
set.seed(100) 

tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)
```

```{r}
#  три “ящика с усами” на одном графике
boxplot(value~therapy,
        data = tumor, 
        main = "исследуемые препараты", 
        xlab = "препараты", 
        ylab = "размер опухоли", 
        col = c("red", "blue", "green"))
```

```{r}
# проверяем данные переменной value (размер опухоли) на нормальность. 

shapiro.test(tumor$value)

```
p-value = 0.76 => данные распределены нормально. Значит, мы можем применять дисперсионный анализ anova. Однофакторный, т.к. у нас одна переменная - размер опухоли,и несколько (3) группы - различные препараты.

```{r}
tumor_mode <- tumor %>%
  mutate(value = as.numeric(value),
         therapy = as.factor(therapy))
```

```{r}
#Н0 -  все средние группы равны
# Н1 - по крайней мере одно среднее значение группы отличается от остальных
aov_model <- aov(value~therapy, data = tumor_mode)

```
Вывод статистики:
 Df  Sum Sq Mean Sq F value  Pr(>F)   
therapy      2 3893804 1946902   6.693 0.00436 **
Residuals   27 7854397  290904                   
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

как видно из вывода статистики, p-value =  0.00436, это меньше, чем 0.05, а значит принимаем Н1 (альтернативная гипотеза) - по крайней мере одно среднее значение группы отличается от остальных

Для провеки этого утверждения и для понимания что именно от чего отличается, дальше проведем попарные сравнения при помощи критерия Тьюки.

```{r}
TukeyHSD(aov_model, conf.level=.95) 
plot(TukeyHSD(aov_model, conf.level=.95)) # визуализация
```
Как видно по выводу статистики (р-value для A-0 = 0.3612181, В-0 = 0.0032790, В-А = 0.0827872 - значения p-value для A-0 и В-А  больше 0.05, значит разница в средних групповых не является статистически значимой. А вот для пары В-0  p-value меньше 0.05, значит значит разница в средних групповых ЯВЛЯЕТСЯ статистически значимой), а так же по визуализации с помощью графика, доверительные интервалы для A-0 и  В-А пересекают 0 - а значит так же разница в средних групповых не является статистически значимой. А для пары В-0 не пересекает 0, значит разница средних является стат.значимой.

Вывод:
На основании данных, можно сделать вывод что препарат В оказывает значимое влияние на размеры опухоли в отличае от плацебо, а препарат А - не оказывает влияния на размер опухоли в сравнении с плацебо. 


