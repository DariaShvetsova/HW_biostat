---
title: "HW6"
author: "KurochkinaDN"
date: "2024-04-16"
output: html_document
---

Описание ДЗ
При выполнении этого домашнего задания вам необходимо посчитать выборки для различных типов точек. Напишите соответствующий код, пользуясь указанными формулами.

Пусть наш спонсор заинтересован, чтобы исследование имело 80% мощность, а уровень значимости — 5%, ожидаемый drop-out rate = 10%.

Что нужно сделать:
(3 балла) Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20% ( = 0.20), а разница средних составляет −10% (). Клиницисты сообщают нам, что клинически значимая разница составляет 25% ( = 0.25).

Воспользуйтесь следующей формулой:

(3 балла) Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна. Пусть клинически значимая разница  = -0.1, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата  = 0.65, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет  = 0.85. Соотношение групп равно  = 1.

Воспользуйтесь следующей формулой:

(4 балла) Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов ( = 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны ().

*задание 1.*
*Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20% ( = 0.20), а разница средних составляет −10% (). Клиницисты сообщают нам, что клинически значимая разница составляет 25% *

```{r}
# Установим значения для переменных
alpha <- 0.05       # Уровень значимости
power <- 0.80       # Мощность исследования
sigma_squared <- 0.20   # Дисперсия
delta <- -0.10      # Разница средних
delta_clinically <- 0.25   # Клинически значимая разница
dropout_rate <- 0.10


# Рассчитаем стандартное отклонение
sigma <- sqrt(sigma_squared)

# Рассчитаем необходимый объем выборки
n <- ceiling((qnorm(1 - alpha/2) * (sqrt(2) * sigma + abs(delta) * sqrt(2 - 2 * delta)) / delta_clinically)^2)

# Выведем результат
print(paste("Необходимый объем выборки:", n))

```
Ответ: Необходимый объем выборки: 38


*задание 2.*
*Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна. Пусть клинически значимая разница  = -0.1, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата  = 0.65, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет  = 0.85. Соотношение групп равно  = 1.*

```{r}
# Установим значения для переменных
alpha <- 0.05       # Уровень значимости
power <- 0.80       # Мощность исследования
dropout_rate <- 0.10

p2  = 0.65  # доля ответов для тестового препарата 
delta_clinically <- -0.1   # Клинически значимая разница
p_compare = 0.85 #   доля ответов у препарата сравнения
# Соотношение групп равно  = k = 1.

 #размер выборки для каждой группы
n <- ((((z_alpha_2 + z_beta)^2) * (delta_clinically * (1 - delta_clinically) + p2 * (1 - p2))) / (delta_clinically - p2 - delta)^2) * 1
n <- n / (1 - dropout_rate)

# итоговая выборка
n_result <- n * 2

cat("выборка для гипотезы non-inferiority для двухвыборочного параллельного дизайна:", round(n_result), "\n")

```
Ответ: выборка для гипотезы non-inferiority для двухвыборочного параллельного дизайна = 5

*Задание 3.*
*Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов ( = 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны ().*

```{r}
# Заданные параметры
hr <- 2 # hazard ratio
group_1 <- 0.5 # соотношение групп
group_2 <- 0.5 # соотношение групп
d <- 0.8 # доля тех пациентов, кто столкнулся с заболеванием

alpha <- 0.05 # Уровень значимости
power <- 0.80 # Мощность исследования
dropout_rate <- 0.10 # Доля пациентов, выбывших из исследования

# Критические значения стандартного нормального распределения
Z_alpha <- qnorm(1 - alpha/2)
Z_power <- qnorm(power)

# Рассчитываем размер выборки для каждой группы
n_1 <- n_2 <- (Z_alpha + Z_power)^2 / (log(hr)^2 * group_1 * group_2 * d * (1 - dropout_rate))

# Рассчитываем общий размер выборки
n <- n_1 + n_2

# Вывод результатов
cat("Размер выборки для каждой группы:", round(n_1), "\n")
cat("Общий размер выборки:", round(n))

```

